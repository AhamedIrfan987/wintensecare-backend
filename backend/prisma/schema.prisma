generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String?  @unique
  phone     String?  @unique
  password  String
  role      String   @default("user")
  devices   Device[]
  createdAt DateTime @default(now())
}

model Device {
  id        String   @id @default(uuid())
  name      String
  type      String
  userId    String
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id])

  telemetry Telemetry[]

  // ECG
  ecg        ECG[]
  ecgSummaries ECGSummary[]

  // SpO2
  spo2Samples SpO2Sample[] @relation("DeviceSpO2Samples")
 
}

model Telemetry {
  id       String @id @default(uuid())
  deviceId String
  device   Device @relation(fields: [deviceId], references: [id])

  heartRate Int
  steps     Int
  battery   Int

  createdAt DateTime @default(now())
}

model Alert {
  id       String @id @default(uuid())
  userId   String
  deviceId String

  metric   String // HEART_RATE, BATTERY, OFFLINE
  value    Int
  severity String // INFO, WARNING, CRITICAL
  message  String

  acknowledged Boolean @default(false)

  createdAt DateTime @default(now())
}


model ECG {
  id           String   @id @default(uuid())
  deviceId     String

  lead         String   @default("I")
  unit         String   @default("mV")
  samplingRate Int
  paperSpeed   Int      @default(25)
  gain         Int      @default(10)

  signal       Float[]
  durationMs   Int
  quality      Int      @default(50)

  createdAt    DateTime @default(now())

  device Device @relation(fields: [deviceId], references: [id])
}




model ECGSummary {
  id        String   @id @default(uuid())
  deviceId  String
  window    String
  avgHR     Int
  minHR     Int
  maxHR     Int
  rrVar     Float
  pvcCount  Int
  quality   Int
  createdAt DateTime @default(now())

  device Device @relation(fields: [deviceId], references: [id])
}

model SpO2Sample {
  id        String   @id @default(uuid())
  deviceId  String
  value     Int
  perfusion Int?
  createdAt DateTime @default(now())

  device Device @relation("DeviceSpO2Samples", fields: [deviceId], references: [id])

  @@index([deviceId, createdAt])
}
